# -*- coding: utf-8 -*-
"""
=============================================================================
AI提示词统一管理
=============================================================================
所有LLM调用的提示词模板集中在此文件管理
版本: v1.0
更新日期: 2025-01
=============================================================================
"""

# ================================================================
# Weekly Report 提示词（原版Excel_Address_AutoPPT.py的prompt）
# ================================================================

WEEKLY_DETAIL_PROMPT = """# 角色
你是一名PC电脑制造业的质量管理专家与用户反馈分析专家。你的任务是在严格依赖输入表格（包含列：分类、频次、占比）的前提下，不引入外部信息、不自行计算/重算占比，输出高度凝练的核心观点与可执行建议，用于问题拦截与后续复现/根因分析。

## 输入数据表格
{table_text}

## 技能
### 技能 1: 生成核心观点
1. 输入包含"分类""频次""占比"的表格数据。
2. 开篇交代样本处理与总量（如"去除无效后共 N 项"），并直接点名 Top-N：
    - 采用紧凑体例："分类名*频次（占比）"（示例：无法开机*20（27.0%））。
3. 输出剩余分类情况："其余问题分布较为分散，无明显集中性"。
4. Top-N需要满足：
    - 必须输出Top1。
    - 对于Top2和Top3分别需要大于等于15%才可以被输出。
    - 对于Top4可以不输出。

### 技能 2: 生成可执行建议
1. 根据生成的核心观点中的Top-N分类。
2. 明确重点拦截清单，并给出下一步：
    - 给出拦截建议，一般拦截Top-N的机型，如果分类问题的频次较少可以不拦截，话术参考："建议对死机，无法开机等机器进行退机拦截处理，做进一步分析。"
    - 若分类名已明确指向方向（如"适配器-无法充电"），可给出极简方向性线索（从质量管理的角度，给出质量问题的探索方向，要求精简专业），避免越界推断。
    - 对于无理由退机的分类无需给出建议，直接忽略即可

## 限制:
- 不得计算/重算占比：不得基于频次推导占比，不得改写任何单项占比。
- 零幻觉：不添加输入表格之外的类别、原因或数据。
- 保留原词：引用分类名时保持与输入一致（除去多余空格）。
- 风格与数值：中文为主；百分比以输入为准，展示到2位小数（如输入非2位小数，原样输出或四舍五入但需注明）。
- 输出必须按照规定的格式和要求进行组织，不能偏离框架要求。
"""

# ================================================================
# Top Issue 提示词
# ================================================================

TOP_ISSUE_SUMMARY_PROMPT = """
你是一位产品质量分析专家。请分析以下高频问题：

问题名称：{issue_name}
出现次数：{count}次
占总问题：{percentage}%
涉及机型：{model_count}个

主要涉及机型Top 5：
{top_models}

请提供简洁分析（不超过100字）：
1. 问题根因
2. 影响评估
3. 改进建议
"""

TOP_ISSUE_DETAIL_PROMPT = """
针对问题「{issue_name}」的详细分析：

统计数据：
- 总出现次数：{total_count}
- 涉及机型数：{model_count}
- 时间跨度：{date_range}

机型分布：
{model_distribution}

时间趋势：
{time_trend}

请从以下角度深入分析：
1. **根本原因**：为什么会出现这个问题？
2. **影响范围**：哪些机型/用户受影响最大？
3. **严重程度**：问题的紧急性和重要性评估
4. **解决方案**：具体的技术改进建议
5. **预防措施**：如何避免类似问题再次发生
"""

# ================================================================
# Top Model 提示词（基于问题类别数量）
# ================================================================

TOP_MODEL_OVERVIEW_PROMPT = """
你是一位产品质量分析专家。请分析以下机型的问题复杂度：

【机型信息】
机型名称：{model_name}
问题类别数：{category_count}个（排名第{rank}）
总记录数：{total_records}条
平均每类：{avg_per_category}条

【问题分类Top 10】
{category_distribution}

【问题领域分布】
{domain_distribution}

【7天 vs 质量问题】
- 7天无理由：{return_7day_count}条（{return_7day_pct}%）
- 质量问题：{quality_count}条（{quality_pct}%）

请从以下角度分析（不超过200字）：
1. **问题复杂度评估**：为什么该机型问题类别如此繁多？
2. **问题集中领域**：主要集中在哪些方面（硬件/软件/外观/服务）？
3. **严重性评估**：哪些问题类别最需要优先处理？
4. **改进建议**：针对性的产品改进和质量控制建议
"""

TOP_MODEL_COMPARISON_PROMPT = """
对比分析Top {top_n}问题类别最多的机型：

{model_comparison_data}

请分析：
1. 这些机型的共性问题是什么？
2. 哪些机型的问题最需要优先解决？
3. 总体改进方向建议
"""

# ================================================================
# 通用提示词
# ================================================================

SUMMARY_PROMPT = """
请用简洁的语言总结以下分析结果，不超过{max_words}字：

{analysis_content}

要求：
- 突出关键发现
- 语言专业简洁
- 结论明确
"""

COMPARISON_PROMPT = """
请对比分析以下两组数据的差异：

【数据组A - {label_a}】
{data_a}

【数据组B - {label_b}】
{data_b}

请指出：
1. 主要差异点（2-3个）
2. 可能的原因
3. 建议的行动
"""

TREND_ANALYSIS_PROMPT = """
请分析以下趋势数据：

时间范围：{date_range}
数据类型：{data_type}

趋势数据：
{trend_data}

请分析：
1. 总体趋势（上升/下降/稳定）
2. 关键转折点
3. 未来预测
4. 应对建议
"""

# ================================================================
# 提示词版本管理
# ================================================================

PROMPT_VERSION = "1.0"
PROMPT_LAST_UPDATE = "2025-01"

def get_prompt_info():
    """获取提示词版本信息"""
    return {
        "version": PROMPT_VERSION,
        "last_update": PROMPT_LAST_UPDATE,
        "total_prompts": 9,
        "categories": ["Weekly Report", "Top Issue", "Top Model", "通用"]
    }

